<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TX Workspace</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <style>
    /* Critical CSS - inline for faster rendering */
    * { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; height: 100%; }
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif; }
    :root {
      --bg1: #020617;
      --bg2: #020617;
      --glass: rgba(15, 23, 42, 0.92);
      --border: rgba(148, 163, 184, 0.28);
      --accent: #7f5af0;
      --accent-soft: rgba(127, 90, 240, 0.16);
      --accent2: #2cb67d;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --radius-lg: 18px;
      --radius-sm: 10px;
      --transition: 0.25s ease;
    }
    
    /* Light mode */
    :root.light {
      --bg1: #f8fafc;
      --bg2: #ffffff;
      --glass: rgba(255, 255, 255, 0.95);
      --border: rgba(148, 163, 184, 0.3);
      --text: #1e293b;
      --muted: #64748b;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter", sans-serif;
      color: var(--text);
      background: radial-gradient(ellipse at top, #1e3a8a 0%, #1e1b4b 25%, #020617 60%, #000 100%);
      transition: background 0.3s ease, color 0.3s ease;
      position: relative;
      overflow-x: hidden;
    }
    
    /* Animated background particles - optimized with will-change */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(127, 90, 240, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(44, 182, 125, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
      will-change: transform;
      transform: translateZ(0);
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    
    body.loaded::before {
      opacity: 1;
      animation: float 20s ease-in-out infinite;
    }
    
    @keyframes float {
      0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
      33% { transform: translate3d(30px, -30px, 0) scale(1.1); }
      66% { transform: translate3d(-20px, 20px, 0) scale(0.9); }
    }
    
    :root.light html, :root.light body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f8fafc 60%, #e2e8f0 100%);
    }
    
    :root.light body::before {
      background-image: 
        radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 14px;
      gap: 14px;
      position: relative;
      z-index: 1;
    }

    /* HEADER */
    header {
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(20,20,34,0.95));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(127, 90, 240, 0.1) inset;
      position: relative;
      overflow: hidden;
      will-change: transform, opacity;
      transform: translateZ(0);
    }
    
    header.loaded {
      animation: slideDown 0.3s ease-out;
    }
    
    header::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(127, 90, 240, 0.1), transparent);
      will-change: transform;
      transform: translateZ(0);
    }
    
    header.loaded::before {
      animation: shimmer 3s infinite;
    }
    
    @keyframes slideDown {
      from { transform: translate3d(0, -20px, 0); opacity: 0; }
      to { transform: translate3d(0, 0, 0); opacity: 1; }
    }
    
    @keyframes shimmer {
      0% { transform: translate3d(-100%, 0, 0); }
      100% { transform: translate3d(100%, 0, 0); }
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      background: linear-gradient(135deg, #7f5af0 0%, #2cb67d 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: #ffffff;
      box-shadow:
        0 0 0 2px rgba(127, 90, 240, 0.3),
        0 4px 20px rgba(127, 90, 240, 0.4),
        0 0 40px rgba(127, 90, 240, 0.2);
      position: relative;
      will-change: transform;
      transform: translateZ(0);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .brand-logo.loaded {
      animation: pulse 2s ease-in-out infinite;
    }
    
    .brand-logo:hover {
      transform: scale(1.1) rotate(5deg) translateZ(0);
      box-shadow:
        0 0 0 2px rgba(127, 90, 240, 0.5),
        0 8px 30px rgba(127, 90, 240, 0.6),
        0 0 60px rgba(127, 90, 240, 0.3);
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 2px rgba(127, 90, 240, 0.3), 0 4px 20px rgba(127, 90, 240, 0.4), 0 0 40px rgba(127, 90, 240, 0.2); }
      50% { box-shadow: 0 0 0 3px rgba(127, 90, 240, 0.5), 0 6px 30px rgba(127, 90, 240, 0.6), 0 0 60px rgba(127, 90, 240, 0.4); }
    }

    .brand-text h1 {
      margin: 0;
      font-size: 1.2rem;
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .brand-text p {
      margin: 2px 0 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 6px;
      min-width: 180px;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .theme-toggle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(127, 90, 240, 0.1), rgba(15,23,42,0.9));
      color: var(--text);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-size: 18px;
      position: relative;
      overflow: hidden;
    }
    
    .theme-toggle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(127, 90, 240, 0.2);
      transform: translate(-50%, -50%);
      transition: width 0.3s ease, height 0.3s ease;
    }
    
    .theme-toggle:hover::before {
      width: 100%;
      height: 100%;
    }
    
    .theme-toggle:hover {
      background: linear-gradient(135deg, rgba(127, 90, 240, 0.2), rgba(15,23,42,0.95));
      border-color: var(--accent);
      transform: scale(1.1) rotate(15deg);
      box-shadow: 0 4px 20px rgba(127, 90, 240, 0.3);
    }
    
    .theme-toggle:active {
      transform: scale(0.95);
    }

    .status-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .status-lights {
      display: flex;
      gap: 5px;
      padding: 3px 7px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(55,65,81,0.9);
    }

    .light {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      box-shadow: 0 0 8px rgba(15,23,42,0.9);
    }

    .light.green {
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34,197,94,0.9);
    }

    .light.yellow {
      background: #eab308;
      box-shadow: 0 0 8px rgba(234,179,8,0.9);
    }

    .light.red {
      background: #ef4444;
      box-shadow: 0 0 8px rgba(239,68,68,0.9);
    }

    .status-text {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .badge {
      font-size: 0.75rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.5);
      background: rgba(15,23,42,0.95);
      color: var(--muted);
      white-space: nowrap;
    }
    .badge strong { color: var(--accent2); }

    /* MAIN LAYOUT */
    .layout-main {
      flex: 1;
      min-height: 0;
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap: 14px;
    }

    /* SIDEBAR */
    .sidebar {
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(20,20,34,0.95));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      padding: 14px 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(127, 90, 240, 0.1) inset;
      position: relative;
      will-change: transform, opacity;
      transform: translateZ(0);
    }
    
    .sidebar.loaded {
      animation: slideInLeft 0.3s ease-out;
    }
    
    @keyframes slideInLeft {
      from { transform: translate3d(-20px, 0, 0); opacity: 0; }
      to { transform: translate3d(0, 0, 0); opacity: 1; }
    }

    .sidebar-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--muted);
      padding: 0 6px;
    }

    .nav-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .nav-btn {
      border: none;
      width: 100%;
      text-align: left;
      padding: 12px 14px;
      border-radius: var(--radius-sm);
      background: linear-gradient(135deg, rgba(148,163,184,0.05), rgba(15,23,42,0.95));
      color: var(--muted);
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      outline: none;
      border: 1px solid rgba(148,163,184,0.15);
      transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
      will-change: transform;
      transform: translateZ(0);
    }
    
    .nav-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(127, 90, 240, 0.1), transparent);
      will-change: transform;
      transform: translateZ(0);
      transition: transform 0.4s ease;
    }
    
    .nav-btn:hover::before {
      transform: translate3d(200%, 0, 0);
    }

    .nav-btn span.icon {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, rgba(248,250,252,0.9), rgba(148,163,184,0.7));
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: #020617;
    }

    .nav-btn strong {
      font-weight: 600;
      color: #e5e7eb;
    }

    .nav-btn small {
      font-size: 0.72rem;
      color: var(--muted);
      display: block;
    }

    .nav-btn:hover {
      transform: translate3d(4px, -2px, 0);
      border-color: rgba(127, 90, 240, 0.4);
      box-shadow: 
        0 4px 20px rgba(127, 90, 240, 0.2),
        0 0 0 1px rgba(127, 90, 240, 0.1) inset;
      color: #e5e7eb;
      background: linear-gradient(135deg, rgba(127, 90, 240, 0.1), rgba(15,23,42,0.98));
    }

    .nav-btn.active {
      background: linear-gradient(135deg, rgba(127, 90, 240, 0.25), rgba(15,23,42,0.98));
      border-color: rgba(127, 90, 240, 0.6);
      box-shadow: 
        0 4px 25px rgba(127, 90, 240, 0.4),
        0 0 0 2px rgba(127, 90, 240, 0.2) inset,
        0 0 40px rgba(127, 90, 240, 0.15);
      color: #f9fafb;
      transform: translate3d(4px, 0, 0);
    }
    
    .nav-btn.active::after {
      content: '';
      position: absolute;
      right: 10px;
      width: 4px;
      height: 60%;
      background: linear-gradient(180deg, #7f5af0, #2cb67d);
      border-radius: 2px;
      will-change: transform, opacity;
      transform: translateZ(0);
    }
    
    .nav-btn.active.loaded::after {
      animation: slideInRight 0.2s ease-out;
    }
    
    @keyframes slideInRight {
      from { transform: translate3d(10px, 0, 0); opacity: 0; }
      to { transform: translate3d(0, 0, 0); opacity: 1; }
    }

    .nav-btn.active span.icon {
      background: radial-gradient(circle at 30% 20%, #f4f4ff, #4f46e5);
      color: #0b1020;
    }

    .side-note {
      margin-top: auto;
      font-size: 0.76rem;
      color: var(--muted);
      padding: 6px;
      border-radius: 10px;
      background: radial-gradient(circle at 0 0, rgba(148,163,184,0.18), rgba(15,23,42,0.96));
      border: 1px dashed rgba(148,163,184,0.4);
    }

    .side-note b { color: #e5e7eb; }

    .side-note ol {
      margin: 4px 0 0;
      padding-left: 18px;
    }

    .side-note li {
      margin-bottom: 2px;
    }
    
    /* Search in sidebar */
    .sidebar-search {
      margin-bottom: 10px;
      position: relative;
    }
    
    .sidebar-search input {
      width: 100%;
      padding: 10px 14px;
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.7), rgba(20, 20, 34, 0.7));
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .sidebar-search input:focus {
      border-color: var(--accent);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.9), rgba(20, 20, 34, 0.9));
      box-shadow: 
        0 0 0 3px rgba(127, 90, 240, 0.2),
        0 4px 20px rgba(127, 90, 240, 0.1);
      transform: translateY(-1px);
    }
    
    .sidebar-search input::placeholder {
      color: var(--muted);
    }
    
    /* Tooltip */
    [data-tooltip] {
      position: relative;
    }
    
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      border-radius: 6px;
      font-size: 0.75rem;
      white-space: nowrap;
      z-index: 1000;
      margin-bottom: 5px;
      pointer-events: none;
    }
    
    /* Notification system */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 12px 16px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      z-index: 10000;
      animation: slideIn 0.3s ease-out;
      max-width: 300px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .notification.success {
      border-color: var(--accent2);
      background: rgba(44, 182, 125, 0.1);
    }
    
    .notification.error {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    /* Keyboard shortcut hint */
    .kbd-hint {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.7rem;
      color: var(--muted);
      margin-left: 8px;
    }
    
    .kbd-key {
      padding: 2px 6px;
      background: rgba(148, 163, 184, 0.2);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.7rem;
    }

    /* MAIN PANEL */
    .main-panel {
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(15,23,42,0.95), rgba(20,20,34,0.95));
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 0;
      box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(127, 90, 240, 0.1) inset;
      overflow: hidden;
      position: relative;
      will-change: transform, opacity;
      transform: translateZ(0);
    }
    
    .main-panel.loaded {
      animation: fadeInUp 0.3s ease-out;
    }
    
    @keyframes fadeInUp {
      from { transform: translate3d(0, 20px, 0); opacity: 0; }
      to { transform: translate3d(0, 0, 0); opacity: 1; }
    }

    .main-header {
      padding: 12px 16px;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(55,65,81,0.95);
      background: radial-gradient(circle at top left, rgba(31,41,55,0.9), rgba(15,23,42,1));
    }

    .main-header h2 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .main-header p {
      margin: 2px 0 0;
      font-size: 0.8rem;
      color: var(--muted);
    }

    .main-header-tags {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .tag {
      font-size: 0.72rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.4);
      color: var(--muted);
      background: rgba(15,23,42,0.96);
      white-space: nowrap;
    }

    .tag.state {
      border-color: rgba(34,197,94,0.7);
      color: #bbf7d0;
    }

    .tag.mode {
      border-style: dashed;
      border-color: rgba(148,163,184,0.6);
    }

    iframe {
      flex: 1;
      width: 100%;
      border: none;
      background: #020617;
      transition: opacity 0.3s ease;
    }
    
    :root.light iframe {
      background: #ffffff;
    }

    /* FOOTER */
    footer {
      margin-top: 6px;
      font-size: 0.76rem;
      color: var(--muted);
      text-align: center;
    }

    footer span { opacity: 0.9; }

    /* Command Palette */
    .command-palette {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      max-width: 90vw;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      z-index: 10000;
      display: none;
      overflow: hidden;
      animation: fadeInUp 0.2s ease-out;
    }
    
    .command-palette.active {
      display: block;
    }
    
    .command-palette input {
      width: 100%;
      padding: 16px 20px;
      background: transparent;
      border: none;
      border-bottom: 1px solid var(--border);
      color: var(--text);
      font-size: 1.1rem;
      outline: none;
    }
    
    .command-palette-results {
      max-height: 400px;
      overflow-y: auto;
      padding: 8px;
    }
    
    .command-item {
      padding: 12px 16px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: background 0.2s ease;
      margin-bottom: 4px;
    }
    
    .command-item:hover,
    .command-item.selected {
      background: var(--accent-soft);
    }
    
    .command-item-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }
    
    .command-item-info {
      flex: 1;
    }
    
    .command-item-title {
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
    }
    
    .command-item-desc {
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    .command-item-shortcut {
      font-size: 0.75rem;
      color: var(--muted);
      padding: 4px 8px;
      background: rgba(148, 163, 184, 0.1);
      border-radius: 4px;
      font-family: monospace;
    }
    
    /* Settings Panel */
    .settings-panel {
      position: fixed;
      right: -400px;
      top: 0;
      width: 400px;
      height: 100vh;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-left: 1px solid var(--border);
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow-y: auto;
    }
    
    .settings-panel.active {
      right: 0;
    }
    
    .settings-header {
      padding: 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .settings-content {
      padding: 20px;
    }
    
    .settings-section {
      margin-bottom: 24px;
    }
    
    .settings-section-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 12px;
    }
    
    .settings-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
    }
    
    .settings-item:last-child {
      border-bottom: none;
    }
    
    .settings-item-label {
      flex: 1;
    }
    
    .settings-item-title {
      font-weight: 500;
      color: var(--text);
      margin-bottom: 4px;
    }
    
    .settings-item-desc {
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    .toggle-switch {
      width: 48px;
      height: 24px;
      background: rgba(148, 163, 184, 0.3);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    
    .toggle-switch.active {
      background: var(--accent);
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: transform 0.3s ease;
    }
    
    .toggle-switch.active::after {
      transform: translateX(24px);
    }
    
    /* Statistics Dashboard */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(127, 90, 240, 0.1), rgba(15, 23, 42, 0.9));
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 16px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 4px;
    }
    
    .stat-label {
      font-size: 0.85rem;
      color: var(--muted);
    }
    
    /* Recent Activity */
    .activity-list {
      max-height: 300px;
      overflow-y: auto;
    }
    
    .activity-item {
      padding: 12px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.1);
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .activity-item:last-child {
      border-bottom: none;
    }
    
    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: var(--accent-soft);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
    
    .activity-info {
      flex: 1;
    }
    
    .activity-title {
      font-size: 0.9rem;
      color: var(--text);
      margin-bottom: 2px;
    }
    
    .activity-time {
      font-size: 0.75rem;
      color: var(--muted);
    }
    
    /* Keyboard Shortcuts Guide */
    .shortcuts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 16px;
    }
    
    .shortcut-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: rgba(148, 163, 184, 0.05);
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
    }
    
    .shortcut-key {
      display: flex;
      gap: 4px;
    }
    
    .key {
      padding: 4px 8px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 4px;
      font-size: 0.75rem;
      font-family: monospace;
      color: var(--text);
    }
    
    /* Overlay */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 9998;
      display: none;
    }
    
    .overlay.active {
      display: block;
    }
    
    /* RESPONSIVE */
    @media (max-width: 900px) {
      .layout-main {
        grid-template-columns: 1fr;
      }
      .sidebar {
        order: 2;
      }
      .main-panel {
        order: 1;
      }
      header {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-right {
        align-items: flex-start;
      }
    }

    @media (max-width: 600px) {
      .app-shell { padding: 10px; }
      .main-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .main-header-tags {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- HEADER -->
    <header>
      <div class="brand">
        <div class="brand-logo">Tx</div>
        <div class="brand-text">
          <h1>TX Workspace</h1>
          <p>M·ªôt c·ª≠a cho t·∫•t c·∫£ c√°c c√¥ng c·ª• l√†m vi·ªác h√†ng ng√†y.</p>
        </div>
      </div>
      <div class="header-right">
        <div class="status-row">
          <div class="status-lights" aria-hidden="true">
            <div class="light green" title="H·ªá th·ªëng s·∫µn s√†ng"></div>
            <div class="light yellow" title="ƒêang t·∫£i n·ªôi dung"></div>
            <div class="light red" title="Khu v·ª±c d·ª± ph√≤ng"></div>
          </div>
          <span class="status-text">4 khu v·ª±c c√¥ng c·ª• ‚Ä¢ Giao di·ªán m·ªôt trang.</span>
        </div>
        <div class="header-actions">
          <button class="theme-toggle" id="themeToggle" data-tooltip="Chuy·ªÉn ƒë·ªïi Dark/Light mode (D)" title="Chuy·ªÉn ƒë·ªïi Dark/Light mode">üåô</button>
          <button class="theme-toggle" id="settingsToggle" data-tooltip="C√†i ƒë·∫∑t" title="C√†i ƒë·∫∑t" style="margin-left: 8px;">‚öôÔ∏è</button>
          <button class="theme-toggle" id="commandPaletteToggle" data-tooltip="Command Palette (Ctrl+K)" title="Command Palette" style="margin-left: 8px;">‚åò</button>
          <div class="badge">Ch·∫ø ƒë·ªô s·ª≠ d·ª•ng: <strong>C√° nh√¢n / N·ªôi b·ªô</strong></div>
        </div>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="layout-main">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <div class="sidebar-title">Ch·ªçn khu v·ª±c c√¥ng c·ª•</div>
        <div class="sidebar-search">
          <input type="text" id="sidebarSearch" placeholder="üîç T√¨m ki·∫øm c√¥ng c·ª•..." autocomplete="off" />
        </div>
        <div class="nav-list" id="navList">
          <button class="nav-btn active" data-target="code1.html" data-keywords="d·ªØ li·ªáu t√†i li·ªáu b·∫£ng vƒÉn b·∫£n h√¨nh ·∫£nh thi·∫øt k·∫ø">
            <span class="icon">1</span>
            <div>
              <strong>Trung t√¢m d·ªØ li·ªáu & t√†i li·ªáu</strong>
              <small>Xem v√† x·ª≠ l√Ω b·∫£ng d·ªØ li·ªáu, n·ªôi dung vƒÉn b·∫£n, h√¨nh ·∫£nh ph·ª•c v·ª• thi·∫øt k·∫ø.</small>
            </div>
          </button>

          <button class="nav-btn" data-target="code2.html" data-keywords="k√≠ch th∆∞·ªõc s·∫£n ph·∫©m tra c·ª©u th√¥ng s·ªë s·∫£n xu·∫•t th√™u">
            <span class="icon">2</span>
            <div>
              <strong>Trung t√¢m k√≠ch th∆∞·ªõc & s·∫£n ph·∫©m</strong>
              <small>Tra c·ª©u th√¥ng tin s·∫£n ph·∫©m, k√≠ch th∆∞·ªõc, th√¥ng s·ªë ph·ª•c v·ª• s·∫£n xu·∫•t.</small>
            </div>
          </button>

          <button class="nav-btn" data-target="code3.html" data-keywords="m·ªü r·ªông qu·∫£n l√Ω ƒë∆°n QC kho">
            <span class="icon">3</span>
            <div>
              <strong>Khu v·ª±c m·ªü r·ªông 1</strong>
              <small>D√†nh cho c√°c c√¥ng c·ª• b·ªï sung kh√°c (qu·∫£n l√Ω ƒë∆°n, QC, kho‚Ä¶).</small>
            </div>
          </button>

          <button class="nav-btn" data-target="code4.html" data-keywords="m·ªü r·ªông d·ª± ph√≤ng t√≠nh nƒÉng">
            <span class="icon">4</span>
            <div>
              <strong>Khu v·ª±c m·ªü r·ªông 2</strong>
              <small>D·ª± ph√≤ng cho c√°c t√≠nh nƒÉng m·ªõi trong t∆∞∆°ng lai.</small>
            </div>
          </button>
        </div>

        <div class="side-note">
          <b>H∆∞·ªõng d·∫´n nhanh cho ng∆∞·ªùi d√πng:</b>
          <ol>
            <li>Ch·ªçn khu v·ª±c ph√π h·ª£p v·ªõi c√¥ng vi·ªác b·∫°n mu·ªën th·ª±c hi·ªán ·ªü b√™n tr√°i.</li>
            <li>C√¥ng c·ª• s·∫Ω m·ªü ngay trong khung l·ªõn b√™n ph·∫£i, kh√¥ng c·∫ßn chuy·ªÉn trang.</li>
            <li>N·∫øu n·ªôi dung kh√¥ng hi·ªÉn th·ªã, h√£y li√™n h·ªá qu·∫£n tr·ªã vi√™n ƒë·ªÉ ki·ªÉm tra c·∫•u h√¨nh.</li>
          </ol>
        </div>
      </aside>

      <!-- MAIN PANEL -->
      <section class="main-panel">
        <div class="main-header">
          <div>
            <h2 id="panelTitle">Trung t√¢m d·ªØ li·ªáu & t√†i li·ªáu</h2>
            <p id="panelDesc">Khu v·ª±c t·ªïng h·ª£p ƒë·ªÉ xem, l·ªçc v√† x·ª≠ l√Ω th√¥ng tin ph·ª•c v·ª• thi·∫øt k·∫ø v√† ƒë·ªëi so√°t.</p>
          </div>
          <div class="main-header-tags">
            <span class="tag state" id="stateTag">Tr·∫°ng th√°i: ƒëang hi·ªÉn th·ªã</span>
            <span class="tag mode">Ch·∫ø ƒë·ªô xem: to√†n m√†n h√¨nh</span>
          </div>
        </div>
        <iframe id="appFrame" src="code1.html" title="TX Tool Frame" loading="eager"></iframe>
      </section>
    </div>

    <!-- FOOTER -->
    <footer>
      <span>TX Workspace gi√∫p gom t·∫•t c·∫£ c√¥ng c·ª• c·ªßa b·∫°n v√†o m·ªôt giao di·ªán th·ªëng nh·∫•t, d·ªÖ hi·ªÉu v√† d·ªÖ s·ª≠ d·ª•ng cho m·ªçi ng∆∞·ªùi.</span>
    </footer>
  </div>

  <!-- Command Palette -->
  <div class="overlay" id="commandOverlay"></div>
  <div class="command-palette" id="commandPalette">
    <input type="text" id="commandInput" placeholder="Nh·∫≠p l·ªánh ho·∫∑c t√¨m ki·∫øm... (Esc ƒë·ªÉ ƒë√≥ng)" autocomplete="off" />
    <div class="command-palette-results" id="commandResults"></div>
  </div>

  <!-- Settings Panel -->
  <div class="overlay" id="settingsOverlay"></div>
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h3 style="margin: 0; font-size: 1.2rem;">‚öôÔ∏è C√†i ƒë·∫∑t</h3>
      <button class="theme-toggle" id="settingsClose" style="background: transparent; border: none; font-size: 1.2rem; cursor: pointer;">‚úï</button>
    </div>
    <div class="settings-content">
      <div class="settings-section">
        <div class="settings-section-title">Giao di·ªán</div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">Dark Mode</div>
            <div class="settings-item-desc">Chuy·ªÉn ƒë·ªïi gi·ªØa ch·∫ø ƒë·ªô s√°ng v√† t·ªëi</div>
          </div>
          <div class="toggle-switch" id="darkModeToggle"></div>
        </div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">Animations</div>
            <div class="settings-item-desc">B·∫≠t/t·∫Øt hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông</div>
          </div>
          <div class="toggle-switch active" id="animationsToggle"></div>
        </div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">Compact Mode</div>
            <div class="settings-item-desc">Giao di·ªán g·ªçn g√†ng h∆°n</div>
          </div>
          <div class="toggle-switch" id="compactModeToggle"></div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">Th·ªëng k√™</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="statTools">4</div>
            <div class="stat-label">C√¥ng c·ª•</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statSessions">0</div>
            <div class="stat-label">Phi√™n l√†m vi·ªác</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statTime">0h</div>
            <div class="stat-label">Th·ªùi gian s·ª≠ d·ª•ng</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="statSwitches">0</div>
            <div class="stat-label">L·∫ßn chuy·ªÉn ƒë·ªïi</div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</div>
        <div class="activity-list" id="activityList">
          <div class="activity-item">
            <div class="activity-icon">üìä</div>
            <div class="activity-info">
              <div class="activity-title">Kh·ªüi ƒë·ªông workspace</div>
              <div class="activity-time">V·ª´a xong</div>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">Ph√≠m t·∫Øt</div>
        <div class="shortcuts-grid">
          <div class="shortcut-item">
            <span>Command Palette</span>
            <div class="shortcut-key">
              <span class="key">Ctrl</span>
              <span class="key">K</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span>ƒê·ªïi Theme</span>
            <div class="shortcut-key">
              <span class="key">D</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span>T√¨m ki·∫øm</span>
            <div class="shortcut-key">
              <span class="key">/</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span>C√†i ƒë·∫∑t</span>
            <div class="shortcut-key">
              <span class="key">Ctrl</span>
              <span class="key">,</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span>Khu v·ª±c 1</span>
            <div class="shortcut-key">
              <span class="key">1</span>
            </div>
          </div>
          <div class="shortcut-item">
            <span>Khu v·ª±c 2</span>
            <div class="shortcut-key">
              <span class="key">2</span>
            </div>
          </div>
        </div>
      </div>

      <div class="settings-section">
        <div class="settings-section-title">D·ªØ li·ªáu</div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">Xu·∫•t c√†i ƒë·∫∑t</div>
            <div class="settings-item-desc">T·∫£i xu·ªëng file c·∫•u h√¨nh</div>
          </div>
          <button class="button" id="exportSettings" style="padding: 6px 12px; font-size: 0.85rem;">üì• Xu·∫•t</button>
        </div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">Nh·∫≠p c√†i ƒë·∫∑t</div>
            <div class="settings-item-desc">T·∫£i l√™n file c·∫•u h√¨nh</div>
          </div>
          <button class="button" id="importSettings" style="padding: 6px 12px; font-size: 0.85rem;">üì§ Nh·∫≠p</button>
        </div>
        <div class="settings-item">
          <div class="settings-item-label">
            <div class="settings-item-title">X√≥a d·ªØ li·ªáu</div>
            <div class="settings-item-desc">X√≥a t·∫•t c·∫£ d·ªØ li·ªáu ƒë√£ l∆∞u</div>
          </div>
          <button class="button button-danger" id="clearData" style="padding: 6px 12px; font-size: 0.85rem;">üóëÔ∏è X√≥a</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const frame = document.getElementById('appFrame');
      const buttons = document.querySelectorAll('.nav-btn');
      const title = document.getElementById('panelTitle');
      const desc = document.getElementById('panelDesc');
      const stateTag = document.getElementById('stateTag');
      const sidebarSearch = document.getElementById('sidebarSearch');
      const navList = document.getElementById('navList');
      const themeToggle = document.getElementById('themeToggle');
      
      // Theme toggle
      function initTheme() {
        const savedTheme = localStorage.getItem('tx-theme') || 'dark';
        document.documentElement.classList.toggle('light', savedTheme === 'light');
        themeToggle.textContent = savedTheme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      }
      
      themeToggle.addEventListener('click', () => {
        const isLight = document.documentElement.classList.toggle('light');
        localStorage.setItem('tx-theme', isLight ? 'light' : 'dark');
        themeToggle.textContent = isLight ? '‚òÄÔ∏è' : 'üåô';
        showNotification('ƒê√£ chuy·ªÉn sang ' + (isLight ? 'ch·∫ø ƒë·ªô s√°ng' : 'ch·∫ø ƒë·ªô t·ªëi'), 'success');
      });
      
      initTheme();
      
      // Sidebar search
      sidebarSearch.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase().trim();
        buttons.forEach(btn => {
          const keywords = btn.getAttribute('data-keywords') || '';
          const text = btn.textContent.toLowerCase();
          const match = !query || keywords.includes(query) || text.includes(query);
          btn.style.display = match ? '' : 'none';
        });
      });
      
      // Notification system
      function showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
          <span>${type === 'success' ? '‚úì' : type === 'error' ? '‚úï' : '‚Ñπ'}</span>
          <span>${message}</span>
        `;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.animation = 'slideIn 0.3s ease-out reverse';
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        // Toggle theme with D
        if (e.key === 'd' && !e.ctrlKey && !e.metaKey && !e.altKey) {
          const activeElement = document.activeElement;
          if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
            themeToggle.click();
          }
        }
        
        // Navigate with number keys
        if (e.key >= '1' && e.key <= '4' && !e.ctrlKey && !e.metaKey && !e.altKey) {
          const activeElement = document.activeElement;
          if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
            const index = parseInt(e.key) - 1;
            const visibleButtons = Array.from(buttons).filter(b => b.style.display !== 'none');
            if (visibleButtons[index]) {
              visibleButtons[index].click();
            }
          }
        }
        
        // Focus search with /
        if (e.key === '/' && !e.ctrlKey && !e.metaKey && !e.altKey) {
          const activeElement = document.activeElement;
          if (activeElement.tagName !== 'INPUT' && activeElement.tagName !== 'TEXTAREA') {
            e.preventDefault();
            sidebarSearch.focus();
          }
        }
      });

      const meta = {
        "code1.html": {
          title: "Trung t√¢m d·ªØ li·ªáu & t√†i li·ªáu",
          desc: "Khu v·ª±c t·ªïng h·ª£p ƒë·ªÉ xem, l·ªçc v√† x·ª≠ l√Ω th√¥ng tin ph·ª•c v·ª• thi·∫øt k·∫ø v√† ƒë·ªëi so√°t.",
          state: "ƒëang hi·ªÉn th·ªã"
        },
        "code2.html": {
          title: "Trung t√¢m k√≠ch th∆∞·ªõc & s·∫£n ph·∫©m",
          desc: "Kh√¥ng gian l√†m vi·ªác d√†nh cho c√°c c√¥ng c·ª• tra c·ª©u s·∫£n ph·∫©m, k√≠ch th∆∞·ªõc v√† th√¥ng s·ªë s·∫£n xu·∫•t.",
          state: "ƒëang hi·ªÉn th·ªã"
        },
        "code3.html": {
          title: "Khu v·ª±c m·ªü r·ªông 1",
          desc: "Ch·ªó tr·ªëng d√†nh cho c√°c c√¥ng c·ª• n√¢ng cao kh√°c. Khi ƒë∆∞·ª£c c·∫•u h√¨nh, khu v·ª±c n√†y s·∫Ω ho·∫°t ƒë·ªông nh∆∞ m·ªôt ·ª©ng d·ª•ng ƒë·ªôc l·∫≠p.",
          state: "ch·ªù c·∫•u h√¨nh"
        },
        "code4.html": {
          title: "Khu v·ª±c m·ªü r·ªông 2",
          desc: "Khu v·ª±c d·ª± ph√≤ng ƒë·ªÉ b·∫°n th√™m nh·ªØng c√¥ng c·ª• m·ªõi trong t∆∞∆°ng lai khi c·∫ßn.",
          state: "ch·ªù c·∫•u h√¨nh"
        }
      };

      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          const target = btn.getAttribute('data-target');

          buttons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');

          // Smooth transition
          frame.style.opacity = '0.5';
          setTimeout(() => {
            frame.src = target;
            frame.style.opacity = '1';
          }, 150);

          if (meta[target]) {
            title.textContent = meta[target].title;
            desc.textContent = meta[target].desc;
            stateTag.textContent = "Tr·∫°ng th√°i: " + meta[target].state;
            showNotification(`ƒê√£ chuy·ªÉn sang: ${meta[target].title}`, 'success');
          }
        });
      });
      
      // Frame load handler
      frame.addEventListener('load', () => {
        frame.style.opacity = '1';
      });
      
      // Optimized loading - use requestAnimationFrame for smooth animations
      requestAnimationFrame(() => {
        document.body.classList.add('loaded');
        document.querySelector('header')?.classList.add('loaded');
        document.querySelector('.sidebar')?.classList.add('loaded');
        document.querySelector('.main-panel')?.classList.add('loaded');
        document.querySelector('.brand-logo')?.classList.add('loaded');
        document.querySelectorAll('.nav-btn.active').forEach(btn => btn.classList.add('loaded'));
        
        // Delay non-critical notifications
        setTimeout(() => {
          showNotification('Ch√†o m·ª´ng ƒë·∫øn TX Workspace! Nh·∫•n D ƒë·ªÉ ƒë·ªïi theme, / ƒë·ªÉ t√¨m ki·∫øm', 'success');
        }, 800);
      });
      
      // Add smooth scroll behavior
      document.documentElement.style.scrollBehavior = 'smooth';
      
      // Add loading animation for iframe
      frame.addEventListener('loadstart', () => {
        frame.style.opacity = '0.5';
      });
      
      // Add tooltip on hover for nav buttons
      buttons.forEach((btn, idx) => {
        btn.setAttribute('title', `Nh·∫•n ${idx + 1} ƒë·ªÉ chuy·ªÉn ƒë·∫øn khu v·ª±c n√†y`);
      });
      
      // Command Palette
      const commandPalette = document.getElementById('commandPalette');
      const commandInput = document.getElementById('commandInput');
      const commandResults = document.getElementById('commandResults');
      const commandOverlay = document.getElementById('commandOverlay');
      const commandPaletteToggle = document.getElementById('commandPaletteToggle');
      let selectedCommandIndex = 0;
      
      const commands = [
        { id: 'area1', title: 'Trung t√¢m d·ªØ li·ªáu & t√†i li·ªáu', desc: 'Chuy·ªÉn ƒë·∫øn khu v·ª±c 1', icon: 'üìä', action: () => buttons[0].click() },
        { id: 'area2', title: 'Trung t√¢m k√≠ch th∆∞·ªõc & s·∫£n ph·∫©m', desc: 'Chuy·ªÉn ƒë·∫øn khu v·ª±c 2', icon: 'üìè', action: () => buttons[1].click() },
        { id: 'area3', title: 'Khu v·ª±c m·ªü r·ªông 1', desc: 'Chuy·ªÉn ƒë·∫øn khu v·ª±c 3', icon: 'üîß', action: () => buttons[2].click() },
        { id: 'area4', title: 'Khu v·ª±c m·ªü r·ªông 2', desc: 'Chuy·ªÉn ƒë·∫øn khu v·ª±c 4', icon: '‚ö°', action: () => buttons[3].click() },
        { id: 'theme', title: 'ƒê·ªïi Theme', desc: 'Chuy·ªÉn ƒë·ªïi Dark/Light mode', icon: 'üåô', action: () => themeToggle.click() },
        { id: 'settings', title: 'C√†i ƒë·∫∑t', desc: 'M·ªü b·∫£ng c√†i ƒë·∫∑t', icon: '‚öôÔ∏è', action: () => openSettings() },
        { id: 'search', title: 'T√¨m ki·∫øm', desc: 'T√¨m ki·∫øm c√¥ng c·ª•', icon: 'üîç', action: () => sidebarSearch.focus() },
      ];
      
      function renderCommands(query = '') {
        const filtered = commands.filter(cmd => 
          cmd.title.toLowerCase().includes(query.toLowerCase()) ||
          cmd.desc.toLowerCase().includes(query.toLowerCase())
        );
        
        commandResults.innerHTML = filtered.map((cmd, idx) => `
          <div class="command-item ${idx === selectedCommandIndex ? 'selected' : ''}" data-index="${idx}" data-id="${cmd.id}">
            <div class="command-item-icon">${cmd.icon}</div>
            <div class="command-item-info">
              <div class="command-item-title">${cmd.title}</div>
              <div class="command-item-desc">${cmd.desc}</div>
            </div>
            <div class="command-item-shortcut">Enter</div>
          </div>
        `).join('');
        
        if (filtered.length > 0) {
          commandResults.querySelectorAll('.command-item').forEach(item => {
            item.addEventListener('click', () => {
              const cmd = filtered[parseInt(item.dataset.index)];
              cmd.action();
              closeCommandPalette();
            });
          });
        }
      }
      
      function openCommandPalette() {
        commandPalette.classList.add('active');
        commandOverlay.classList.add('active');
        commandInput.focus();
        selectedCommandIndex = 0;
        renderCommands();
      }
      
      function closeCommandPalette() {
        commandPalette.classList.remove('active');
        commandOverlay.classList.remove('active');
        commandInput.value = '';
      }
      
      commandPaletteToggle.addEventListener('click', openCommandPalette);
      commandOverlay.addEventListener('click', closeCommandPalette);
      
      commandInput.addEventListener('input', (e) => {
        renderCommands(e.target.value);
        selectedCommandIndex = 0;
      });
      
      commandInput.addEventListener('keydown', (e) => {
        const items = commandResults.querySelectorAll('.command-item');
        if (e.key === 'ArrowDown') {
          e.preventDefault();
          selectedCommandIndex = Math.min(selectedCommandIndex + 1, items.length - 1);
          items[selectedCommandIndex]?.scrollIntoView({ block: 'nearest' });
          renderCommands(commandInput.value);
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          selectedCommandIndex = Math.max(selectedCommandIndex - 1, 0);
          items[selectedCommandIndex]?.scrollIntoView({ block: 'nearest' });
          renderCommands(commandInput.value);
        } else if (e.key === 'Enter' && items[selectedCommandIndex]) {
          e.preventDefault();
          items[selectedCommandIndex].click();
        } else if (e.key === 'Escape') {
          closeCommandPalette();
        }
      });
      
      // Settings Panel
      const settingsPanel = document.getElementById('settingsPanel');
      const settingsOverlay = document.getElementById('settingsOverlay');
      const settingsToggle = document.getElementById('settingsToggle');
      const settingsClose = document.getElementById('settingsClose');
      
      function openSettings() {
        settingsPanel.classList.add('active');
        settingsOverlay.classList.add('active');
        updateStats();
        updateActivity();
      }
      
      function closeSettings() {
        settingsPanel.classList.remove('active');
        settingsOverlay.classList.remove('active');
      }
      
      settingsToggle.addEventListener('click', openSettings);
      settingsClose.addEventListener('click', closeSettings);
      settingsOverlay.addEventListener('click', closeSettings);
      
      // Settings Toggles
      const darkModeToggle = document.getElementById('darkModeToggle');
      const animationsToggle = document.getElementById('animationsToggle');
      const compactModeToggle = document.getElementById('compactModeToggle');
      
      darkModeToggle.classList.toggle('active', !document.documentElement.classList.contains('light'));
      darkModeToggle.addEventListener('click', () => {
        themeToggle.click();
        darkModeToggle.classList.toggle('active');
      });
      
      animationsToggle.addEventListener('click', () => {
        animationsToggle.classList.toggle('active');
        document.documentElement.style.setProperty('--transition', animationsToggle.classList.contains('active') ? '0.25s ease' : '0s');
      });
      
      compactModeToggle.addEventListener('click', () => {
        compactModeToggle.classList.toggle('active');
        document.body.classList.toggle('compact-mode');
      });
      
      // Statistics
      let sessionStart = Date.now();
      let switchCount = localStorage.getItem('tx-switch-count') || 0;
      
      function updateStats() {
        const sessions = parseInt(localStorage.getItem('tx-sessions') || '0') + 1;
        localStorage.setItem('tx-sessions', sessions);
        const timeSpent = Math.floor((Date.now() - sessionStart) / 3600000);
        
        document.getElementById('statSessions').textContent = sessions;
        document.getElementById('statTime').textContent = timeSpent + 'h';
        document.getElementById('statSwitches').textContent = switchCount;
      }
      
      function updateActivity() {
        const activities = JSON.parse(localStorage.getItem('tx-activities') || '[]');
        const activityList = document.getElementById('activityList');
        
        activityList.innerHTML = activities.slice(0, 10).map(act => `
          <div class="activity-item">
            <div class="activity-icon">${act.icon}</div>
            <div class="activity-info">
              <div class="activity-title">${act.title}</div>
              <div class="activity-time">${act.time}</div>
            </div>
          </div>
        `).join('');
      }
      
      function addActivity(icon, title) {
        const activities = JSON.parse(localStorage.getItem('tx-activities') || '[]');
        activities.unshift({
          icon,
          title,
          time: new Date().toLocaleString('vi-VN')
        });
        localStorage.setItem('tx-activities', JSON.stringify(activities.slice(0, 50)));
        updateActivity();
      }
      
      // Track switches
      buttons.forEach(btn => {
        btn.addEventListener('click', () => {
          switchCount++;
          localStorage.setItem('tx-switch-count', switchCount);
          addActivity('üîÑ', `Chuy·ªÉn ƒë·∫øn: ${btn.querySelector('strong').textContent}`);
        });
      });
      
      // Export/Import Settings
      document.getElementById('exportSettings').addEventListener('click', () => {
        const settings = {
          theme: localStorage.getItem('tx-theme'),
          activities: localStorage.getItem('tx-activities'),
          sessions: localStorage.getItem('tx-sessions'),
          switchCount: localStorage.getItem('tx-switch-count')
        };
        const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'tx-workspace-settings.json';
        a.click();
        URL.revokeObjectURL(url);
        showNotification('ƒê√£ xu·∫•t c√†i ƒë·∫∑t th√†nh c√¥ng', 'success');
      });
      
      document.getElementById('importSettings').addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const settings = JSON.parse(e.target.result);
                if (settings.theme) localStorage.setItem('tx-theme', settings.theme);
                if (settings.activities) localStorage.setItem('tx-activities', settings.activities);
                showNotification('ƒê√£ nh·∫≠p c√†i ƒë·∫∑t th√†nh c√¥ng', 'success');
                location.reload();
              } catch (err) {
                showNotification('L·ªói khi nh·∫≠p c√†i ƒë·∫∑t', 'error');
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      });
      
      document.getElementById('clearData').addEventListener('click', () => {
        if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu?')) {
          localStorage.clear();
          showNotification('ƒê√£ x√≥a d·ªØ li·ªáu', 'success');
          setTimeout(() => location.reload(), 1000);
        }
      });
      
      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'k') {
          e.preventDefault();
          openCommandPalette();
        }
        if (e.ctrlKey && e.key === ',') {
          e.preventDefault();
          openSettings();
        }
        if (e.key === 'Escape') {
          closeCommandPalette();
          closeSettings();
        }
      });
      
      // Initial activity
      addActivity('üöÄ', 'Kh·ªüi ƒë·ªông workspace');
    })();
  </script>
</body>
</html>
